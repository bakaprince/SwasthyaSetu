<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <link rel="icon" type="image/png" href="../assets/icons/favicon.png" />
    <title>Hospital Connectivity - Government Portal</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Playfair+Display:wght@600;700&display=swap"
        rel="stylesheet" />

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />

    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#86efac",
                        secondary: "#113841",
                        "secondary-light": "#1d525e",
                        "background-dark": "#0d2b32",
                        "gov-gold": "#ffd700",
                    },
                    fontFamily: {
                        display: ["Playfair Display", "serif"],
                        sans: ["DM Sans", "sans-serif"],
                    },
                },
            },
        };
    </script>

    <style>
        .nav-link {
            transition: all 0.2s;
            position: relative;
        }

        .nav-link:hover {
            color: #86efac;
        }

        .nav-link.active {
            color: #86efac;
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 3px;
            background: #86efac;
        }

        .hero-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2386efac' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4v-4H4v4H0v2h4v4h2v-4h4v-2H6zM36 4v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .status-badge {
            animation: pulse-soft 2s ease-in-out infinite;
        }

        @keyframes pulse-soft {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .state-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .state-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            margin: auto;
            padding: 0;
            width: 95%;
            max-width: 1400px;
            max-height: 90vh;
            border-radius: 16px;
            overflow: hidden;
            animation: slideDown 0.3s ease;
        }

        /* Force full screen for detail modal */
        #hospital-detail-modal .modal-content {
            width: 100% !important;
            height: 100% !important;
            max-width: none !important;
            max-height: none !important;
            margin: 0 !important;
            border-radius: 0 !important;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #113841;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-gray-50 dark:bg-background-dark font-sans antialiased">

    <!-- Top Navigation -->
    <nav class="bg-secondary dark:bg-secondary text-white border-b border-white/10">
        <!-- Top Bar -->
        <div class="px-8 py-4 flex items-center justify-between border-b border-white/10">
            <a href="../index.html" class="flex items-center gap-3">
                <img src="../assets/images/logo.png" alt="SwasthyaSetu Logo" class="h-8 w-auto">
                <div class="flex flex-col">
                    <span class="text-xs font-bold text-gov-gold tracking-widest uppercase">MoHFW Interop Portal</span>
                    <span class="text-xs text-primary font-bold">GOVERNMENT</span>
                </div>
            </a>

            <div class="flex items-center gap-4">
                <div class="relative hidden lg:block">
                    <input type="text" id="search-input" placeholder="Search state or hospital..."
                        class="w-80 pl-10 pr-4 py-2 bg-secondary-light border border-white/20 rounded-lg text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    <span class="material-icons-outlined absolute left-3 top-2.5 text-gray-400 text-sm">search</span>
                </div>
                <div class="flex items-center gap-3 ml-4 pl-4 border-l border-white/20">
                    <img src="https://ui-avatars.com/api/?name=Gov+Admin&background=ffd700&color=113841" alt="User"
                        class="w-8 h-8 rounded-full border border-gov-gold">
                    <div>
                        <p class="text-sm font-semibold" id="admin-name">Ministry Admin</p>
                        <p class="text-xs text-gov-gold" id="admin-dept">National Health Authority</p>
                    </div>
                </div>
                <button id="logout-btn"
                    class="ml-4 px-4 py-2 bg-red-500/80 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">
                    Logout
                </button>
            </div>
        </div>

        <!-- Navigation Links -->
        <div class="px-8 py-0 flex items-center gap-8">
            <a href="government-dashboard.html"
                class="nav-link flex items-center gap-2 px-4 py-4 text-sm font-medium text-gray-300">
                <span class="material-icons-outlined text-lg">insights</span>
                National Dashboard
            </a>
            <a href="government-hospitals.html"
                class="nav-link active flex items-center gap-2 px-4 py-4 text-sm font-medium">
                <span class="material-icons-outlined text-lg">domain</span>
                Hospital Connectivity
            </a>
            <a href="government-resources.html"
                class="nav-link flex items-center gap-2 px-4 py-4 text-sm font-medium text-gray-300">
                <span class="material-icons-outlined text-lg">inventory_2</span>
                Resource Allocation
            </a>
            <a href="government-outbreak.html"
                class="nav-link flex items-center gap-2 px-4 py-4 text-sm font-medium text-gray-300">
                <span class="material-icons-outlined text-lg">coronavirus</span>
                Outbreak Predictions
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="p-8 hero-pattern min-h-screen">

        <!-- Page Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-secondary dark:text-white mb-1 font-display">Hospital Connectivity -
                State-wise View</h1>
            <p class="text-gray-600 dark:text-gray-400">Monitor real-time connectivity across all states and union
                territories</p>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="flex items-center justify-center py-20">
            <div class="text-center">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-600 dark:text-gray-400">Loading hospital connectivity data...</p>
            </div>
        </div>

        <!-- States Grid -->
        <div id="states-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
            style="display: none;">
            <!-- State cards will be dynamically inserted here -->
        </div>

    </main>

    <!-- State Detail Modal -->
    <div id="state-modal" class="modal">
        <div class="modal-content dark:bg-gray-800">
            <div class="bg-secondary text-white p-6 flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold font-display" id="modal-state-name">-</h2>
                    <p class="text-sm text-primary mt-1" id="modal-hospital-count">-</p>
                </div>
                <button onclick="closeModal()" class="text-white hover:text-primary transition-colors">
                    <span class="material-icons-outlined text-3xl">close</span>
                </button>
            </div>

            <div class="p-6 overflow-y-auto" style="max-height: calc(90vh - 100px);">
                <!-- Hospital Table -->
                <div
                    class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700">
                            <tr>
                                <th
                                    class="px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                    Hospital</th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                    Location</th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                    Type</th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                    Status</th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                    Last Sync</th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                    Uptime</th>
                            </tr>
                        </thead>
                        <tbody id="modal-hospital-list" class="divide-y divide-gray-200 dark:divide-gray-700">
                            <!-- Hospital rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Hospital Detail Modal (Command Center View) -->
    <div id="hospital-detail-modal" class="modal" style="z-index: 105;">
        <div class="modal-content dark:bg-gray-800 w-full h-full max-w-none max-h-none rounded-none m-0 flex flex-col">
            <!-- Header -->
            <div
                class="bg-secondary text-white p-6 flex items-center justify-between border-b border-white/10 shrink-0 shadow-md">
                <div class="flex items-center gap-6">
                    <div
                        class="w-16 h-16 bg-white/10 rounded-xl flex items-center justify-center border border-white/10">
                        <span class="material-icons-outlined text-4xl text-gov-gold">local_hospital</span>
                    </div>
                    <div>
                        <div class="flex items-center gap-4 mb-2">
                            <h2 class="text-3xl font-bold font-display" id="detail-name">AIIMS Delhi</h2>
                            <span id="detail-status-badge"
                                class="px-3 py-1 text-xs rounded-full bg-green-500/20 text-green-300 border border-green-500/30 font-semibold tracking-wide">Connected</span>
                        </div>
                        <div class="flex items-center gap-6 text-sm text-gray-300">
                            <span
                                class="flex items-center gap-2 bg-white/5 px-3 py-1 rounded-lg border border-white/5"><span
                                    class="material-icons-outlined text-sm text-gov-gold">fingerprint</span> ID: <span
                                    id="detail-id" class="font-mono ml-1">HOSP-001</span></span>
                            <span
                                class="flex items-center gap-2 bg-white/5 px-3 py-1 rounded-lg border border-white/5"><span
                                    class="material-icons-outlined text-sm text-gov-gold">category</span> <span
                                    id="detail-type">Government</span></span>
                            <span
                                class="flex items-center gap-2 bg-white/5 px-3 py-1 rounded-lg border border-white/5"><span
                                    class="material-icons-outlined text-sm text-gov-gold">place</span> <span
                                    id="detail-address">Ansari Nagar, New Delhi, Delhi 110029</span></span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-right mr-4 border-r border-white/20 pr-6 hidden xl:block">
                        <p class="text-xs text-gray-400 uppercase tracking-widest mb-1">Medical Superintendent</p>
                        <p class="font-bold">Dr. R. K. Gupta</p>
                    </div>
                    <button
                        class="px-5 py-2.5 bg-white/10 hover:bg-white/20 border border-white/10 rounded-lg text-sm font-semibold flex items-center gap-2 transition-colors">
                        <span class="material-icons-outlined text-lg">print</span> Report
                    </button>
                    <button onclick="closeHospitalDetail()"
                        class="w-12 h-12 flex items-center justify-center rounded-full bg-red-500/80 hover:bg-red-600 text-white transition-all shadow-lg hover:shadow-red-500/30">
                        <span class="material-icons-outlined text-2xl">close</span>
                    </button>
                </div>
            </div>

            <!-- Dashboard Grid -->
            <div class="p-8 overflow-y-auto bg-gray-50 dark:bg-gray-900 grow">
                <div class="grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-6">

                    <!-- Column 1: System Health -->
                    <div class="space-y-6">
                        <div
                            class="bg-white dark:bg-gray-800 rounded-xl p-5 border border-gray-200 dark:border-gray-700 shadow-sm">
                            <h3
                                class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-4">
                                Live System Health</h3>

                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="text-gray-700 dark:text-gray-300">Server CPU Load</span>
                                        <span class="font-bold text-secondary dark:text-white" id="stat-cpu">42%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-blue-500 h-2 rounded-full" style="width: 42%" id="bar-cpu"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="text-gray-700 dark:text-gray-300">Memory Usage</span>
                                        <span class="font-bold text-secondary dark:text-white"
                                            id="stat-memory">68%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-purple-500 h-2 rounded-full" style="width: 68%" id="bar-memory">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="text-gray-700 dark:text-gray-300">Storage</span>
                                        <span class="font-bold text-secondary dark:text-white" id="stat-storage">89 TB /
                                            100 TB</span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-yellow-500 h-2 rounded-full" style="width: 89%" id="bar-storage">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-6 pt-4 border-t border-gray-100 dark:border-gray-700 grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-xs text-gray-500">Network Latency</p>
                                    <p class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-1">
                                        <span class="w-2 h-2 rounded-full bg-green-500"></span> <span
                                            id="stat-latency">24ms</span>
                                    </p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500">Last Backup</p>
                                    <p class="text-sm font-bold text-gray-900 dark:text-white">2 hrs ago</p>
                                </div>
                            </div>
                        </div>

                        <div
                            class="bg-white dark:bg-gray-800 rounded-xl p-5 border border-gray-200 dark:border-gray-700 shadow-sm">
                            <h3
                                class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-4">
                                Compliance Status</h3>
                            <div class="flex items-center justify-between mb-3">
                                <span class="text-sm font-medium text-gray-700 dark:text-gray-300">ABDM
                                    Integration</span>
                                <span
                                    class="px-2 py-0.5 rounded text-xs font-bold bg-green-100 text-green-700 border border-green-200">VERIFIED</span>
                            </div>
                            <div class="flex items-center justify-between mb-3">
                                <span class="text-sm font-medium text-gray-700 dark:text-gray-300">HIPAA Data
                                    Privacy</span>
                                <span
                                    class="px-2 py-0.5 rounded text-xs font-bold bg-green-100 text-green-700 border border-green-200">COMPLIANT</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Encryption
                                    Standard</span>
                                <span class="text-sm font-bold text-secondary dark:text-white">AES-256</span>
                            </div>
                        </div>
                    </div>

                    <!-- Column 2 & 3: Resource Grid & Activity -->
                    <div class="lg:col-span-2 xl:col-span-2 space-y-6">
                        <!-- Resource Stats -->
                        <div class="grid grid-cols-3 gap-4">
                            <div
                                class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 shadow-sm text-center">
                                <div
                                    class="w-10 h-10 mx-auto bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center mb-2">
                                    <span class="material-icons-outlined text-blue-600 dark:text-blue-400">bed</span>
                                </div>
                                <h4 class="text-2xl font-bold text-gray-900 dark:text-white" id="res-beds">842</h4>
                                <p class="text-xs text-gray-500">Available Beds</p>
                            </div>
                            <div
                                class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 shadow-sm text-center">
                                <div
                                    class="w-10 h-10 mx-auto bg-red-50 dark:bg-red-900/20 rounded-full flex items-center justify-center mb-2">
                                    <span class="material-icons-outlined text-red-600 dark:text-red-400">favorite</span>
                                </div>
                                <h4 class="text-2xl font-bold text-gray-900 dark:text-white" id="res-icu">42</h4>
                                <p class="text-xs text-gray-500">ICU Units</p>
                            </div>
                            <div
                                class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 shadow-sm text-center">
                                <div
                                    class="w-10 h-10 mx-auto bg-teal-50 dark:bg-teal-900/20 rounded-full flex items-center justify-center mb-2">
                                    <span
                                        class="material-icons-outlined text-teal-600 dark:text-teal-400">medical_services</span>
                                </div>
                                <h4 class="text-2xl font-bold text-gray-900 dark:text-white" id="res-doctors">156</h4>
                                <p class="text-xs text-gray-500">Active Doctors</p>
                            </div>
                        </div>

                        <!-- Most Common Cases -->
                        <div
                            class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6 mb-6">
                            <h3
                                class="text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                                <span class="material-icons-outlined text-sm">coronavirus</span> Most Active Cases (Last
                                24h)
                            </h3>
                            <div class="space-y-4" id="top-cases-list">
                                <!-- Dynamic content will go here -->
                            </div>
                        </div>

                        <!-- Live Data Stream -->
                        <div
                            class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden h-96 flex flex-col">
                            <div
                                class="p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
                                <h3
                                    class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest">
                                    Live Data Exchange</h3>
                                <div class="flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                                    <span class="text-xs text-green-600 font-bold">Real-time</span>
                                </div>
                            </div>
                            <div class="overflow-y-auto p-0 grow">
                                <table class="w-full text-sm">
                                    <tbody id="detail-logs" class="divide-y divide-gray-100 dark:divide-gray-700">
                                        <!-- Logs generated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Column 4: Quick Actions & Contacts -->
                    <div class="space-y-6">
                        <div
                            class="bg-gradient-to-br from-secondary to-secondary-light rounded-xl p-5 text-white shadow-lg">
                            <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                                <span class="material-icons-outlined">admin_panel_settings</span> Admin Protocol
                            </h3>
                            <div class="space-y-3">
                                <button
                                    class="w-full py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm text-left px-3 flex items-center gap-3 transition-colors">
                                    <span class="material-icons-outlined text-yellow-400">warning</span> Trigger
                                    Emergency Alert
                                </button>
                                <button
                                    class="w-full py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm text-left px-3 flex items-center gap-3 transition-colors">
                                    <span class="material-icons-outlined text-blue-300">sync</span> Force Data Sync
                                </button>
                                <button
                                    class="w-full py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm text-left px-3 flex items-center gap-3 transition-colors">
                                    <span class="material-icons-outlined text-green-300">verified_user</span> Audit
                                    Access Logs
                                </button>
                                <button
                                    class="w-full py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm text-left px-3 flex items-center gap-3 transition-colors">
                                    <span class="material-icons-outlined text-red-300">power_settings_new</span> Restart
                                    Service
                                </button>
                            </div>
                        </div>

                        <div
                            class="bg-white dark:bg-gray-800 rounded-xl p-5 border border-gray-200 dark:border-gray-700 shadow-sm">
                            <h3
                                class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-4">
                                Key Contacts</h3>
                            <div class="space-y-4">
                                <div class="flex items-center gap-3">
                                    <img src="https://ui-avatars.com/api/?name=Medical+Director&background=random"
                                        class="w-8 h-8 rounded-full">
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 dark:text-white">Dr. R. K. Gupta</p>
                                        <p class="text-xs text-gray-500">Medical Director</p>
                                    </div>
                                    <button class="ml-auto text-gray-400 hover:text-secondary"><span
                                            class="material-icons-outlined">call</span></button>
                                </div>
                                <div class="flex items-center gap-3">
                                    <img src="https://ui-avatars.com/api/?name=IT+Head&background=random"
                                        class="w-8 h-8 rounded-full">
                                    <div>
                                        <p class="text-sm font-bold text-gray-900 dark:text-white">Mr. Amit Singh</p>
                                        <p class="text-xs text-gray-500">IT Administrator</p>
                                    </div>
                                    <button class="ml-auto text-gray-400 hover:text-secondary"><span
                                            class="material-icons-outlined">call</span></button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="../js/config/app-config.js"></script>
    <script src="../js/utils/helpers.js"></script>
    <script src="../js/utils/force-login.js"></script>
    <script src="../js/services/auth.js"></script>
    <script src="../js/services/api.js"></script>

    <script>
        // State-wise hospital connectivity management
        let allHospitals = [];
        let stateData = {};

        // Indian States and UTs
        const indianStates = [
            'Andhra Pradesh', 'Arunachal Pradesh', 'Assam', 'Bihar', 'Chhattisgarh',
            'Goa', 'Gujarat', 'Haryana', 'Himachal Pradesh', 'Jharkhand',
            'Karnataka', 'Kerala', 'Madhya Pradesh', 'Maharashtra', 'Manipur',
            'Meghalaya', 'Mizoram', 'Nagaland', 'Odisha', 'Punjab',
            'Rajasthan', 'Sikkim', 'Tamil Nadu', 'Telangana', 'Tripura',
            'Uttar Pradesh', 'Uttarakhand', 'West Bengal',
            'Andaman and Nicobar Islands', 'Chandigarh', 'Dadra and Nagar Haveli and Daman and Diu',
            'Delhi', 'Jammu and Kashmir', 'Ladakh', 'Lakshadweep', 'Puducherry'
        ];

        // Generate random connection status
        function generateRandomStatus() {
            const statuses = ['Connected', 'Pending', 'Offline'];
            const weights = [0.85, 0.10, 0.05]; // 85% connected, 10% pending, 5% offline

            const random = Math.random();
            let sum = 0;
            for (let i = 0; i < weights.length; i++) {
                sum += weights[i];
                if (random <= sum) return statuses[i];
            }
            return 'Connected';
        }

        // Generate random uptime
        function generateRandomUptime(status) {
            if (status === 'Connected') return (95 + Math.random() * 5).toFixed(1);
            if (status === 'Pending') return (85 + Math.random() * 10).toFixed(1);
            return (75 + Math.random() * 15).toFixed(1);
        }

        // Generate random last sync time
        function generateRandomLastSync(status) {
            if (status === 'Connected') {
                const minutes = Math.floor(Math.random() * 30);
                return minutes === 0 ? 'Just now' : `${minutes} min${minutes > 1 ? 's' : ''} ago`;
            }
            if (status === 'Pending') {
                const hours = Math.floor(Math.random() * 12) + 1;
                return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            }
            const days = Math.floor(Math.random() * 5) + 1;
            return `${days} day${days > 1 ? 's' : ''} ago`;
        }

        // Process hospitals and assign to states
        function processHospitalData(hospitals) {
            console.log('Original hospital data from API:', hospitals);

            // If hospitals don't have state info, distribute them across states
            allHospitals = hospitals.map((hospital, index) => {
                // Extract state from address or location string
                let assignedState = null;

                // Try to find state in various fields
                if (hospital.state) {
                    assignedState = hospital.state;
                } else if (hospital.location) {
                    // Try to match state from location string
                    assignedState = findStateInString(hospital.location);
                } else if (hospital.address) {
                    assignedState = findStateInString(hospital.address);
                } else if (hospital.city) {
                    assignedState = mapCityToState(hospital.city);
                }

                // If still no state, randomly assign to major states (distribute evenly)
                if (!assignedState || !indianStates.includes(assignedState)) {
                    // Distribute across major states
                    const majorStates = [
                        'Delhi', 'Maharashtra', 'Karnataka', 'Tamil Nadu', 'Gujarat',
                        'Uttar Pradesh', 'West Bengal', 'Rajasthan', 'Madhya Pradesh',
                        'Kerala', 'Punjab', 'Haryana', 'Telangana', 'Bihar', 'Odisha'
                    ];
                    assignedState = majorStates[index % majorStates.length];
                }

                return {
                    ...hospital,
                    state: assignedState,
                    status: generateRandomStatus(),
                    uptime: null,
                    lastSync: null
                };
            });

            // Assign uptime and last sync based on status
            allHospitals.forEach(h => {
                h.uptime = generateRandomUptime(h.status);
                h.lastSync = generateRandomLastSync(h.status);
            });

            console.log('Processed hospitals with states:', allHospitals);

            // Group by state
            stateData = {};
            indianStates.forEach(state => {
                stateData[state] = {
                    connected: 0,
                    pending: 0,
                    offline: 0,
                    total: 0,
                    hospitals: []
                };
            });

            allHospitals.forEach(hospital => {
                const state = hospital.state;
                if (stateData[state]) {
                    stateData[state].hospitals.push(hospital);
                    stateData[state].total++;

                    if (hospital.status === 'Connected') stateData[state].connected++;
                    else if (hospital.status === 'Pending') stateData[state].pending++;
                    else if (hospital.status === 'Offline') stateData[state].offline++;
                }
            });

            console.log('State-wise distribution:', stateData);
            return stateData;
        }

        // Helper function to find state name in a string
        function findStateInString(str) {
            if (!str) return null;
            str = str.toLowerCase();

            // Common state abbreviations and full names
            const stateMap = {
                'delhi': 'Delhi', 'dl': 'Delhi', 'new delhi': 'Delhi',
                'mumbai': 'Maharashtra', 'maharashtra': 'Maharashtra', 'mh': 'Maharashtra', 'pune': 'Maharashtra',
                'bangalore': 'Karnataka', 'karnataka': 'Karnataka', 'ka': 'Karnataka', 'bengaluru': 'Karnataka',
                'chennai': 'Tamil Nadu', 'tamil nadu': 'Tamil Nadu', 'tn': 'Tamil Nadu',
                'ahmedabad': 'Gujarat', 'gujarat': 'Gujarat', 'gj': 'Gujarat',
                'kolkata': 'West Bengal', 'west bengal': 'West Bengal', 'wb': 'West Bengal',
                'hyderabad': 'Telangana', 'telangana': 'Telangana', 'ts': 'Telangana',
                'jaipur': 'Rajasthan', 'rajasthan': 'Rajasthan', 'rj': 'Rajasthan',
                'lucknow': 'Uttar Pradesh', 'uttar pradesh': 'Uttar Pradesh', 'up': 'Uttar Pradesh',
                'kochi': 'Kerala', 'kerala': 'Kerala', 'kl': 'Kerala', 'thiruvananthapuram': 'Kerala',
                'chandigarh': 'Chandigarh', 'punjab': 'Punjab', 'pb': 'Punjab',
                'haryana': 'Haryana', 'hr': 'Haryana', 'gurgaon': 'Haryana',
                'bhopal': 'Madhya Pradesh', 'madhya pradesh': 'Madhya Pradesh', 'mp': 'Madhya Pradesh',
                'patna': 'Bihar', 'bihar': 'Bihar', 'br': 'Bihar',
                'bhubaneswar': 'Odisha', 'odisha': 'Odisha', 'or': 'Odisha'
            };

            for (const [key, state] of Object.entries(stateMap)) {
                if (str.includes(key)) {
                    return state;
                }
            }

            return null;
        }

        // Map city names to states
        function mapCityToState(city) {
            if (!city) return null;
            return findStateInString(city);
        }

        // Render state cards
        function renderStateCards() {
            const grid = document.getElementById('states-grid');
            grid.innerHTML = '';

            Object.entries(stateData).forEach(([state, data]) => {
                if (data.total === 0) return; // Skip states with no hospitals

                const connectivityRate = data.total > 0 ? ((data.connected / data.total) * 100).toFixed(1) : 0;

                const card = document.createElement('div');
                card.className = 'state-card bg-white dark:bg-gray-800 rounded-2xl p-6 border border-gray-200 dark:border-gray-700';
                card.onclick = () => openStateModal(state, data);

                card.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-bold text-secondary dark:text-white">${state}</h3>
                            <p class="text-xs text-gray-500 mt-1">${data.total} hospital${data.total !== 1 ? 's' : ''}</p>
                        </div>
                        <div class="w-12 h-12 bg-secondary/10 rounded-lg flex items-center justify-center">
                            <span class="material-icons-outlined text-secondary">location_on</span>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="flex items-center justify-between text-xs mb-2">
                            <span class="font-semibold text-gray-700 dark:text-gray-300">Connectivity</span>
                            <span class="font-bold ${connectivityRate >= 90 ? 'text-green-600' : connectivityRate >= 70 ? 'text-yellow-600' : 'text-red-600'}">${connectivityRate}%</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                            <div class="h-2 rounded-full ${connectivityRate >= 90 ? 'bg-green-500' : connectivityRate >= 70 ? 'bg-yellow-500' : 'bg-red-500'}" style="width: ${connectivityRate}%"></div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-2 text-center">
                        <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-2">
                            <p class="text-lg font-bold text-green-600">${data.connected}</p>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Online</p>
                        </div>
                        <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-2">
                            <p class="text-lg font-bold text-yellow-600">${data.pending}</p>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Pending</p>
                        </div>
                        <div class="bg-red-50 dark:bg-red-900/20 rounded-lg p-2">
                            <p class="text-lg font-bold text-red-600">${data.offline}</p>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Offline</p>
                        </div>
                    </div>
                `;

                grid.appendChild(card);
            });

            // Update overall stats - check if elements exist first (may be removed)
            const totalConnected = Object.values(stateData).reduce((sum, s) => sum + s.connected, 0);
            const totalPending = Object.values(stateData).reduce((sum, s) => sum + s.pending, 0);
            const totalOffline = Object.values(stateData).reduce((sum, s) => sum + s.offline, 0);

            const elConnected = document.getElementById('total-connected');
            const elPending = document.getElementById('total-pending');
            const elOffline = document.getElementById('total-offline');

            if (elConnected) elConnected.textContent = totalConnected.toLocaleString();
            if (elPending) elPending.textContent = totalPending.toLocaleString();
            if (elOffline) elOffline.textContent = totalOffline.toLocaleString();
        }

        // Open state modal
        function openStateModal(stateName, data) {
            document.getElementById('modal-state-name').textContent = stateName;
            document.getElementById('modal-hospital-count').textContent = `${data.total} Registered Hospitals`;

            const tbody = document.getElementById('modal-hospital-list');
            tbody.innerHTML = '';

            data.hospitals.forEach(hospital => {
                const statusColors = {
                    'Connected': 'green',
                    'Pending': 'yellow',
                    'Offline': 'red'
                };
                const color = statusColors[hospital.status] || 'gray';

                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer group';
                row.onclick = () => openHospitalDetail(hospital); // Make row clickable

                // Add hover effect style
                row.style.transition = 'all 0.2s';

                row.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-secondary/10 rounded-lg flex items-center justify-center group-hover:bg-secondary group-hover:text-white transition-colors">
                                <span class="material-icons-outlined text-secondary group-hover:text-white">local_hospital</span>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-900 dark:text-white group-hover:text-secondary dark:group-hover:text-primary transition-colors">${hospital.name}</p>
                                <p class="text-xs text-gray-500">ID: ${hospital._id || 'HOSP-' + (Math.floor(Math.random() * 9000) + 1000)}</p>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">${hospital.address || hospital.city || stateName}</td>
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full text-xs font-semibold">
                            ${hospital.type || 'General'}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-2">
                            <span class="w-2 h-2 bg-${color}-500 rounded-full status-badge"></span>
                            <span class="text-sm font-semibold text-${color}-600 dark:text-${color}-400">${hospital.status}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">${hospital.lastSync || 'Never'}</td>
                    <td class="px-6 py-4">
                        <button class="flex items-center gap-1 text-xs font-bold text-secondary dark:text-primary hover:underline">
                            VIEW <span class="material-icons-outlined text-sm">arrow_forward</span>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            document.getElementById('state-modal').classList.add('active');
        }

        // Open Hospital Detail Modal (Command Center)
        function openHospitalDetail(hospital) {
            // Update Header Info
            document.getElementById('detail-name').textContent = hospital.name;
            const id = hospital._id || 'HOSP-' + (Math.floor(Math.random() * 9000) + 1000);
            document.getElementById('detail-id').textContent = id;

            // Detailed Address Generation
            const area = `Sector ${Math.floor(Math.random() * 20) + 1}`;
            const city = hospital.city || hospital.state || 'City Center';
            const state = hospital.state || '';
            const pincode = Math.floor(Math.random() * 100000) + 100000;
            const fullAddress = hospital.address || `${area}, ${city}, ${state} ${pincode}, India`;
            const elAddress = document.getElementById('detail-address');
            if (elAddress) elAddress.textContent = fullAddress;

            document.getElementById('detail-type').textContent = hospital.type || 'General Hospital';

            // Status Badge
            const statusBadge = document.getElementById('detail-status-badge');
            if (hospital.status === 'Connected') {
                statusBadge.className = 'px-3 py-1 text-xs rounded-full bg-green-500/20 text-green-300 border border-green-500/30';
                statusBadge.textContent = 'Connected • Real-time';
            } else if (hospital.status === 'Pending') {
                statusBadge.className = 'px-3 py-1 text-xs rounded-full bg-yellow-500/20 text-yellow-300 border border-yellow-500/30';
                statusBadge.textContent = 'Integration Pending';
            } else {
                statusBadge.className = 'px-3 py-1 text-xs rounded-full bg-red-500/20 text-red-300 border border-red-500/30';
                statusBadge.textContent = 'Offline • Action Required';
            }

            // Generate Realistic System Stats
            const cpu = Math.floor(Math.random() * 60) + 20; // 20-80%
            const memory = Math.floor(Math.random() * 50) + 30; // 30-80%
            const storageUsed = Math.floor(Math.random() * 30) + 60; // 60-90 TB
            const latency = hospital.status === 'Connected' ? Math.floor(Math.random() * 40) + 10 : Math.floor(Math.random() * 200) + 100;

            document.getElementById('stat-cpu').textContent = cpu + '%';
            document.getElementById('bar-cpu').style.width = cpu + '%';

            document.getElementById('stat-memory').textContent = memory + '%';
            document.getElementById('bar-memory').style.width = memory + '%';

            document.getElementById('stat-storage').textContent = `${storageUsed} TB / 100 TB`;
            document.getElementById('bar-storage').style.width = storageUsed + '%';

            document.getElementById('stat-latency').textContent = latency + 'ms';
            if (latency > 100) {
                document.getElementById('stat-latency').className = 'text-red-500 font-bold';
            } else {
                document.getElementById('stat-latency').className = 'text-green-500 font-bold';
            }

            // Generate Resource Counts
            const beds = Math.floor(Math.random() * 800) + 200;
            const icu = Math.floor(Math.random() * beds * 0.15); // ~15% are ICU
            const doctors = Math.floor(Math.random() * 200) + 50;
            const ambulance = Math.floor(Math.random() * 15) + 2;

            document.getElementById('res-beds').textContent = beds;
            document.getElementById('res-icu').textContent = icu;
            document.getElementById('res-doctors').textContent = doctors;

            const elAmbulance = document.getElementById('res-ambulance');
            if (elAmbulance) elAmbulance.textContent = ambulance;

            // Generate Top Active Cases
            const diseases = [
                { name: 'Viral Fever', icon: 'thermostat', color: 'orange' },
                { name: 'Dengue / Malaria', icon: 'pest_control', color: 'red' },
                { name: 'Respiratory (Flu)', icon: 'masks', color: 'blue' },
                { name: 'Trauma / Accident', icon: 'local_hospital', color: 'purple' },
                { name: 'Gastroenteritis', icon: 'restaurant', color: 'yellow' }
            ];

            const caseList = document.getElementById('top-cases-list');

            if (caseList) {
                // Shuffle array to make it dynamic
                const shuffled = diseases.sort(() => 0.5 - Math.random());
                caseList.innerHTML = '';
                let remaining = 100;

                for (let i = 0; i < 4; i++) {
                    const disease = shuffled[i];
                    const percentage = Math.floor(Math.random() * (remaining - 10)) + 5;
                    remaining -= percentage;

                    const caseItem = document.createElement('div');
                    caseItem.innerHTML = `
                        <div class="flex justify-between text-sm mb-1">
                            <span class="flex items-center gap-2 text-gray-700 dark:text-gray-300 font-medium">
                                <span class="material-icons-outlined text-sm text-${disease.color}-500">${disease.icon}</span> ${disease.name}
                            </span>
                            <span class="font-bold text-gray-900 dark:text-white">${percentage}%</span>
                        </div>
                        <div class="w-full bg-gray-100 dark:bg-gray-700 rounded-full h-2">
                            <div class="bg-${disease.color}-500 h-2 rounded-full transition-all duration-1000" style="width: ${percentage}%"></div>
                        </div>
                    `;
                    caseList.appendChild(caseItem);
                }
            }

            // Generate Fake Logs
            const logBody = document.getElementById('detail-logs');
            logBody.innerHTML = '';

            const eventTypes = ['Patient Discharge', 'New Admission', 'Lab Report Sync', 'Inventory Update', 'Staff Shift Change', 'Emergency Protocol'];
            const statuses = ['Success', 'Processing', 'Success', 'Success', 'Pending'];

            for (let i = 0; i < 8; i++) {
                const event = eventTypes[Math.floor(Math.random() * eventTypes.length)];
                const status = statuses[Math.floor(Math.random() * statuses.length)];
                const time = new Date(Date.now() - i * 1000 * 60 * Math.floor(Math.random() * 10)).toLocaleTimeString();

                const logRow = document.createElement('tr');
                logRow.className = 'hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors';
                logRow.innerHTML = `
                    <td class="px-4 py-3 text-secondary dark:text-white font-medium">${event}</td>
                    <td class="px-4 py-3 text-gray-500 text-xs">${time}</td>
                    <td class="px-4 py-3 text-right">
                        <span class="text-xs font-bold ${status === 'Success' ? 'text-green-500' : 'text-yellow-500'}">${status.toUpperCase()}</span>
                    </td>
                `;
                logBody.appendChild(logRow);
            }

            // Show Modal
            document.getElementById('hospital-detail-modal').style.display = 'flex';
        }

        function closeHospitalDetail() {
            document.getElementById('hospital-detail-modal').style.display = 'none';
        }

        // Close modal
        function closeModal() {
            document.getElementById('state-modal').classList.remove('active');
        }

        // Close modal on outside click
        window.onclick = function (event) {
            const stateModal = document.getElementById('state-modal');
            const detailModal = document.getElementById('hospital-detail-modal');
            if (event.target === stateModal) {
                closeModal();
            }
            if (event.target === detailModal) {
                closeHospitalDetail();
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize auth service
            AuthService.init();

            // Check authentication
            const user = AuthService.getCurrentUser();
            if (!AuthService.isAuthenticated()) {
                window.location.href = '../index.html';
                return;
            }

            // Fill user details
            const adminName = document.getElementById('admin-name');
            const adminDept = document.getElementById('admin-dept');

            if (user) {
                adminName.textContent = user.name || 'Ministry Admin';
                if (user.department) adminDept.textContent = user.department;
            }

            // Logout handler
            document.getElementById('logout-btn').addEventListener('click', async () => {
                await AuthService.logout();
                Helpers.showToast('Securely logged out', 'success');
                setTimeout(() => {
                    window.location.href = '../index.html';
                }, 1000);
            });

            // Fetch hospital data
            try {
                console.log('Fetching hospitals from API...');
                let response = null;
                try {
                    response = await APIService.getHospitals();
                } catch (e) {
                    console.warn('API fetch failed, falling back to simulation', e);
                }

                console.log('API Response:', response);

                // Handle different response formats
                let hospitals = [];
                if (response) {
                    if (Array.isArray(response)) {
                        hospitals = response;
                    } else if (response.data && Array.isArray(response.data)) {
                        hospitals = response.data;
                    } else if (response.hospitals && Array.isArray(response.hospitals)) {
                        hospitals = response.hospitals;
                    } else if (response.success && response.data) {
                        hospitals = Array.isArray(response.data) ? response.data : [response.data];
                    }
                }

                console.log(`Found ${hospitals.length} hospitals from API`);

                // Simulation Mode: If API returns sparse data (< 20 hospitals), generate mock data to fill the dashboard
                // This ensures the government portal looks populated even with a dev database
                if (hospitals.length < 20) {
                    console.log('API returned sparse data. Generating simulation data for Government Dashboard demo...');
                    const mockHospitals = generateMockHospitals(3000 - hospitals.length); // Target ~3000 total
                    hospitals = [...hospitals, ...mockHospitals];

                    // Show toast to inform user
                    Helpers.showToast('Displaying simulated data for full national view', 'info');
                }

                if (hospitals.length === 0) {
                    throw new Error('No hospitals available to display');
                }

                processHospitalData(hospitals);
                renderStateCards();

                document.getElementById('loading-state').style.display = 'none';
                document.getElementById('states-grid').style.display = 'grid';
            } catch (error) {
                console.error('Error fetching hospitals:', error);
                document.getElementById('loading-state').innerHTML = `
                    <div class="text-center">
                        <span class="material-icons-outlined text-6xl text-red-500 mb-4">error</span>
                        <p class="text-gray-600 dark:text-gray-400 mb-2">Failed to load hospital data</p>
                        <p class="text-sm text-gray-500">${error.message}</p>
                        <p class="text-xs text-gray-400 mt-2">Check browser console for details</p>
                        <button onclick="location.reload()" class="mt-4 px-6 py-2 bg-secondary text-white rounded-lg hover:bg-secondary-light transition-colors">
                            Retry
                        </button>
                    </div>
                `;
            }

            // Generate realistic mock hospitals for simulation
            function generateMockHospitals(count) {
                const mocks = [];
                const types = ['Government', 'District', 'Medical College', 'General'];

                // curated list of real major hospitals for simulation
                const realHospitals = {
                    'Delhi': ['AIIMS Delhi', 'Safdarjung Hospital', 'Lok Nayak Hospital', 'Dr. RML Hospital', 'GTB Hospital', 'Deen Dayal Upadhyay Hospital'],
                    'Maharashtra': ['KEM Hospital', 'JJ Hospital', 'Sion Hospital', 'Nair Hospital', 'Tata Memorial Hospital', 'BJ Medical College', 'Cooper Hospital'],
                    'Karnataka': ['Victoria Hospital', 'Bowring & Lady Curzon', 'NIMHANS', 'KC General Hospital', 'Kidwai Memorial', 'St. Johns Medical College'],
                    'Tamil Nadu': ['Madras Medical College', 'Stanley Medical College', 'Kilpauk Medical College', 'Omandurar Govt Hospital', 'Rajiv Gandhi Govt General Hospital'],
                    'West Bengal': ['SSKM Hospital', 'Calcutta Medical College', 'NRS Medical College', 'RG Kar Medical College', 'Chittaranjan National Cancer Institute'],
                    'Uttar Pradesh': ['KGMU Lucknow', 'SGPGI Lucknow', 'BHU Hospital Varanasi', 'LLR Hospital Kanpur', 'SN Medical College Agra'],
                    'Telangana': ['Osmania General Hospital', 'Gandhi Hospital', 'NIMS Hyderabad', 'King Koti District Hospital'],
                    'Gujarat': ['Civil Hospital Ahmedabad', 'SSG Hospital Vadodara', 'New Civil Hospital Surat', 'PDU Medical College Rajkot'],
                    'Kerala': ['Medical College Trivandrum', 'General Hospital Ernakulam', 'Medical College Calicut', 'Government TD Medical College Alappuzha'],
                    'Rajasthan': ['SMS Hospital Jaipur', 'Jalan Hospital', 'MDM Hospital Jodhpur', 'PBM Hospital Bikaner'],
                    'Madhya Pradesh': ['MY Hospital Indore', 'Hamidia Hospital Bhopal', 'Jaya Arogya Hospital Gwalior', 'Netaji Subhash Chandra Bose College'],
                    'Bihar': ['PMCH Patna', 'NMCH Patna', 'SKMCH Muzaffarpur', 'DMCH Darbhanga', 'JLNMCH Bhagalpur'],
                    'Punjab': ['PGIMER Chandigarh', 'Rajindra Hospital Patiala', 'Guru Nanak Dev Hopsital Amritsar', 'Civil Hospital Ludhiana'],
                    'Haryana': ['Civil Hospital Gurgaon', 'PGIMS Rohtak', 'Civil Hospital Panchkula', 'Kalpana Chawla Govt Medical College'],
                    'Andhra Pradesh': ['King George Hospital Visakhapatnam', 'GGH Vijayawada', 'GGH Guntur', 'SVRR Government General Hospital Tirupati'],
                    'Odisha': ['SCB Medical College Cuttack', 'MKCG Medical College Berhampur', 'AIIMS Bhubaneswar', 'Capital Hospital Bhubaneswar'],
                    'Assam': ['Guwahati Medical College', 'Assam Medical College Dibrugarh', 'Silchar Medical College', 'Jorhat Medical College'],
                    'Jammu and Kashmir': ['SKIMS Srinagar', 'SMHS Hospital', 'GMC Jammu', 'Sher-i-Kashmir Hospital'],
                    'Jharkhand': ['RIMS Ranchi', 'MGM Medical College Jamshedpur', 'Sadar Hospital Dhanbad'],
                    'Chattisgarh': ['Dr. BR Ambedkar Memorial Hospital Raipur', 'CIMS Bilaspur', 'Late BR Kashyap Memorial Bastar'],
                    'Uttarakhand': ['AIIMS Rishikesh', 'Doon Medical College', 'Sushila Tiwari Hospital Haldwani'],
                    'Himachal Pradesh': ['IGMC Shimla', 'Dr. RPGMC Tanda', 'Regional Hospital Kullu'],
                    'Goa': ['Goa Medical College', 'Asilo Hospital Mapusa', 'Hospicio Hospital Margao'],
                    'Tripura': ['AGMC & GBP Hospital', 'Tripura Medical College'],
                    'Manipur': ['RIMS Imphal', 'JNIMS Imphal'],
                    'Meghalaya': ['Civil Hospital Shillong', 'NEIGRIHMS Shillong'],
                    'Nagaland': ['Naga Hospital Authority Kohima', 'District Hospital Dimapur'],
                    'Arunachal Pradesh': ['Tomo Riba Institute (TRIHMS)', 'General Hospital Pasighat'],
                    'Mizoram': ['Civil Hospital Aizawl', 'State Referral Hospital Falkawn'],
                    'Sikkim': ['STNM Hospital Gangtok', 'Central Referral Hospital Gangtok'],
                    'Puducherry': ['JIPMER', 'Indira Gandhi Govt General Hospital'],
                    'Chandigarh': ['GMCH Sector 32', 'GMSH Sector 16'],
                    'Ladakh': ['SNM Hospital Leh', 'District Hospital Kargil'],
                    'Andaman and Nicobar Islands': ['GB Pant Hospital Port Blair'],
                    'Lakshadweep': ['Indira Gandhi Hospital Kavaratti'],
                    'Dadra and Nagar Haveli and Daman and Diu': ['Vinoba Bhave Civil Hospital Silvassa', 'Government Hospital Marwad']
                };

                for (let i = 0; i < count; i++) {
                    const state = indianStates[Math.floor(Math.random() * indianStates.length)];
                    let name;
                    const stateHospitals = realHospitals[state];

                    if (stateHospitals && stateHospitals.length > 0) {
                        name = stateHospitals[Math.floor(Math.random() * stateHospitals.length)];
                    } else {
                        name = `${state} ${types[Math.floor(Math.random() * types.length)]} Hospital`;
                    }

                    mocks.push({
                        _id: `MOCK-${state.substring(0, 3).toUpperCase()}-${Math.floor(Math.random() * 10000)}`,
                        name: name,
                        state: state,
                        city: `${state} City`,
                        type: types[Math.floor(Math.random() * types.length)],
                        location: `${state}, India`,
                        address: `Sector ${Math.floor(Math.random() * 100)}, ${state}`,
                        isSimulated: true
                    });
                }
                return mocks;
            }

            // Search functionality
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const cards = document.querySelectorAll('.state-card');

                cards.forEach(card => {
                    const stateName = card.querySelector('h3').textContent.toLowerCase();
                    if (stateName.includes(query)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });
    </script>
</body>

</html>